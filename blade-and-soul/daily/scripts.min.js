$(document).ready(function(){function t(){$("#daily-table-content").html("");var t=[];checkIfResetHappened()&&(settings.data.done=[],settings.save()),$.each(dailies,function(e,i){var s="";i.dungeon&&(d=echoDungeon(i.dungeon),s='<br><span class="difficulty-'+echoDifficulty(d.difficulty)+'">'+d.name+"</span>");var n=i.name;"object"==typeof i.name&&("cerulean"==settings.data.faction||"crimson"==settings.data.faction?n=i.name[settings.data.faction]:(n="",$.each(i.name,function(t,e){n+=i.name[t]+" / "}),n=n.slice(0,-3)));var l="";$.each(i.categories,function(t,e){l+='<span class="tag '+e.toLowerCase()+'">'+e+"</span>"}),t.push(a.tableRow({dailyDone:settings.data.done[e],dailyValue:i.moneyReward,dailyGold:i.moneyReward,dailyId:e,dailyTags:l,dailyName:n+s,dailyLocation:i.location,dailyMap:echoMap(i.map).name,dailyGoldRewards:echoGold(Math.round(i.moneyReward*settings.data.goldModifier)),dailyMiscRewards:"&nbsp;"}))}),$("#table-wrapper").html(a.table({rows:t})),$(".daily-table").tablesorter({headers:{5:{sorter:"gold"}},sortList:[[5,1]],widgets:["group"],widgetOptions:{group_saveGroups:!0}}).floatThead(),calculateTotalEarnings(),calculateCompletedDailies()}settings.load(),settings.data.localTime=new Date,settings.data.resetTime=new Date(settings.data.resetTime),settings.data.lastModified=new Date(settings.data.lastModified);var e=!1;settings.data.editedTime||(settings.data.resetTime=findNextResetTime(settings.data.localTime)),FastClick.attach(document.body);var a={tableRow:_.template($("#tpl-table-row").html()),table:_.template($("#tpl-table").html()),timeSettingsEdit:_.template($("#tpl-time-settings-edit").html())};setInterval(function(){settings.data.localTime=new Date;var t=prettyDate(settings.data.resetTime,settings.data.localTime);console.log("togo",t,checkIfResetHappened()),t||(e||(alert("The dailies just reset. Reload the site to reset your data"),e=!0),t="the past"),$("#current-time").text(echoCurrentTime()+" ("+echoCurrentTimezone()+")"),$("#daily-reset").text("in "+t+" ("+pad(settings.data.resetTime.getHours(),2)+":"+pad(settings.data.resetTime.getMinutes(),2)+")")},1e3);$(".version").text("v"+settings.data.version),$.tablesorter.addParser({id:"gold",is:function(t,e,a,i){return!1},format:function(t,e,a,i){var s=$(a);return 5==i?s.attr("data-gold")||t:t},parsed:!1,type:"numeric"}),$("#premium-modifier").val(settings.data.goldModifier),$("#faction").val(settings.data.faction),changeDisplayDensity(),$("#premium-modifier").change(function(){settings.update("goldModifier",$(this).val()),calculateMoneyRewards(),calculateTotalEarnings(),ga("send","event","bnsDaily","premiumModifier",$(this).val())}),$("#faction").change(function(){settings.update("faction",$(this).val()),t(),ga("send","event","bnsDaily","faction",$(this).val())}),$(".density-select").click(function(){settings.update("displayDensity",$(this).attr("data-value")),changeDisplayDensity()}),$("#tag-toggle").click(function(){$(".checkbox",this).toggleClass("checked"),$("html").toggleClass("hide-tags"),$(".daily-table").trigger("reflow")}),$(document).on("click",".daily-table tbody tr",function(){$(this).toggleClass("done"),$(this).hasClass("done")&&ga("send","event","bnsDaily","dailyFinished",$(this).attr("data-id")),settings.data.done[$(this).attr("data-id")]=!settings.data.done[$(this).attr("data-id")],settings.data.lastModified=new Date,settings.save(),calculateCompletedDailies(),calculateTotalEarnings()}),$(".debug-dump").click(function(){$("#dump").show().text(btoa(JSON.stringify({userSettings:settings.data,userAgent:navigator.userAgent}))),$("html, body").animate({scrollTop:$(document).height()},"slow"),selectText("dump")}),t()});